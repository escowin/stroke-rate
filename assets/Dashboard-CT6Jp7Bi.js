import{j as e,F as A,a as $,b as C,u as b,c as y,d as M,e as g,f as S,g as E,h as F,i as w,k as R}from"./index-B-7Z-pKn.js";import{r}from"./charts-CsxGdrcq.js";import"./react-vendor-gH-7aFTg.js";import"./utils-DMAiyDia.js";import"./ui-vendor-IWGmed_D.js";function L({title:n,titleId:t,...a},s){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":t},a),n?r.createElement("title",{id:t},n):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 10.5h.375c.621 0 1.125.504 1.125 1.125v2.25c0 .621-.504 1.125-1.125 1.125H21M3.75 18h15A2.25 2.25 0 0 0 21 15.75v-6a2.25 2.25 0 0 0-2.25-2.25h-15A2.25 2.25 0 0 0 1.5 9.75v6A2.25 2.25 0 0 0 3.75 18Z"}))}const I=r.forwardRef(L);function Z({title:n,titleId:t,...a},s){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":t},a),n?r.createElement("title",{id:t},n):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 0 1 3 19.875v-6.75ZM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V8.625ZM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V4.125Z"}))}const T=r.forwardRef(Z);function z({title:n,titleId:t,...a},s){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":t},a),n?r.createElement("title",{id:t},n):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347a1.125 1.125 0 0 1 0 1.972l-11.54 6.347a1.125 1.125 0 0 1-1.667-.986V5.653Z"}))}const B=r.forwardRef(z);function H({title:n,titleId:t,...a},s){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":t},a),n?r.createElement("title",{id:t},n):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5.25 7.5A2.25 2.25 0 0 1 7.5 5.25h9a2.25 2.25 0 0 1 2.25 2.25v9a2.25 2.25 0 0 1-2.25 2.25h-9a2.25 2.25 0 0 1-2.25-2.25v-9Z"}))}const U=r.forwardRef(H);function O({title:n,titleId:t,...a},s){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":t},a),n?r.createElement("title",{id:t},n):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))}const V=r.forwardRef(O),k=(n=190,t=60)=>{const a=r.useMemo(()=>{const c=n-t,m={name:"Recovery",min:Math.round(t+c*.5),max:Math.round(t+c*.6),color:"#10b981",description:"Active recovery and warm-up"},j={name:"Aerobic",min:Math.round(t+c*.6),max:Math.round(t+c*.7),color:"#3b82f6",description:"Base aerobic training"},d={name:"Threshold",min:Math.round(t+c*.7),max:Math.round(t+c*.8),color:"#f59e0b",description:"Lactate threshold training"},o={name:"Anaerobic",min:Math.round(t+c*.8),max:n,color:"#ef4444",description:"High-intensity intervals"};return{recovery:m,aerobic:j,threshold:d,anaerobic:o}},[n,t]),s=c=>c<=a.recovery.max?"recovery":c<=a.aerobic.max?"aerobic":c<=a.threshold.max?"threshold":"anaerobic";return{zones:a,getZoneForHeartRate:s,getZoneColor:c=>{const m=s(c);return a[m].color},getZoneName:c=>{const m=s(c);return a[m].name}}},W=n=>{const[t,a]=r.useState("");return r.useEffect(()=>{if(!n){a("");return}const s=()=>{const v=new Date,c=n.startTime,j=(n.endTime||v).getTime()-c.getTime(),d=Math.floor(j/1e3),o=Math.floor(d/60),x=Math.floor(o/60),u=d%60,l=o%60;let i="";x>0?i=`${x}:${l.toString().padStart(2,"0")}:${u.toString().padStart(2,"0")}`:i=`${l}:${u.toString().padStart(2,"0")}`,a(i)};s();let h=null;return n.isActive&&(h=setInterval(s,1e3)),()=>{h&&clearInterval(h)}},[n]),t},P=({rower:n})=>{const{getZoneColor:t,getZoneName:a}=k(),s=n.currentHeartRate?.heartRate,h=s?a(s):"No Data",v=s?t(s):"#6b7280",c=n.currentHeartRate?.timestamp,j=n.deviceId?s?{status:"connected",icon:C,color:"text-green-500"}:{status:"connecting",icon:C,color:"text-yellow-500"}:{status:"disconnected",icon:$,color:"text-gray-400"},d=j.icon;return e.jsxs("div",{className:"heart-rate-card",children:[e.jsxs("div",{className:"heart-rate-card-header",children:[e.jsxs("div",{className:"heart-rate-card-info",children:[e.jsx("h3",{className:"heart-rate-card-name",children:n.name}),e.jsxs("p",{className:"heart-rate-card-seat",children:["Seat ",n.seat]})]}),e.jsxs("div",{className:"heart-rate-card-status",children:[e.jsx(d,{className:`heart-rate-card-status-icon ${j.status==="connected"?"heart-rate-card-status-icon--connected":j.status==="connecting"?"heart-rate-card-status-icon--connecting":"heart-rate-card-status-icon--disconnected"}`}),e.jsx(I,{className:"heart-rate-card-battery-icon"})]})]}),e.jsxs("div",{className:"heart-rate-display",children:[e.jsxs("div",{className:"heart-rate-value-container",children:[e.jsx(A,{className:"heart-rate-icon"}),e.jsx("div",{className:"heart-rate-value",style:{color:v},children:s||"--"}),e.jsx("div",{className:"heart-rate-unit",children:"BPM"})]}),e.jsx("div",{className:"heart-rate-zone-badge",style:{backgroundColor:v},children:h})]}),s&&e.jsxs("div",{className:"heart-rate-zone-progress",children:[e.jsxs("div",{className:"heart-rate-zone-labels",children:[e.jsx("span",{children:"Recovery"}),e.jsx("span",{children:"Anaerobic"})]}),e.jsx("div",{className:"heart-rate-progress-bar",children:e.jsx("div",{className:"heart-rate-progress-fill",style:{backgroundColor:v,width:`${Math.min(100,(s-60)/130*100)}%`}})})]}),e.jsx("div",{className:"heart-rate-last-update",children:c?`Updated ${c.toLocaleTimeString()}`:"No data received"})]})},X=()=>{const{connectionStatus:n}=b(),{getHealthSummary:t,getUnhealthyConnections:a}=y(),{isScanning:s,connectedDevices:h,availableDevices:v,hasSpeedCoachConflicts:c,conflicts:m}=n,j=t(),d=a(),o=()=>c?g:d.length>0?M:h.length>0?S:s?E:$,x=()=>c?"SpeedCoach conflicts detected":d.length>0?`${d.length} connection(s) unhealthy`:h.length>0?`${h.length} device(s) connected (${j.healthPercentage}% healthy)`:s?"Scanning for devices...":"No devices connected",u=o();return e.jsxs("div",{className:"card-base connection-status",children:[e.jsxs("div",{className:"connection-status-content",children:[e.jsxs("div",{className:"connection-status-info",children:[e.jsx(u,{className:`connection-status-icon ${c?"connection-status-icon--conflict":d.length>0?"connection-status-icon--unhealthy":h.length>0?"connection-status-icon--connected":s?"connection-status-icon--scanning":"connection-status-icon--disconnected"}`}),e.jsxs("div",{children:[e.jsx("p",{className:`connection-status-text ${c?"connection-status-text--conflict":d.length>0?"connection-status-text--unhealthy":h.length>0?"connection-status-text--connected":s?"connection-status-text--scanning":"connection-status-text--disconnected"}`,children:x()}),v.length>0&&e.jsxs("p",{className:"connection-status-subtitle",children:[v.length," device(s) available"]})]})]}),h.length>0&&e.jsx("div",{className:"connection-device-list",children:h.map(l=>{const i=l.isHealthy!==!1;return e.jsxs("div",{className:`connection-device-item ${i?"connection-device-item--healthy":"connection-device-item--unhealthy"}`,children:[e.jsx("div",{className:`connection-device-indicator ${i?"connection-device-indicator--healthy":"connection-device-indicator--unhealthy"}`}),e.jsx("span",{className:`connection-device-name ${i?"connection-device-name--healthy":"connection-device-name--unhealthy"}`,children:l.name})]},l.id)})})]}),d.length>0&&e.jsx("div",{className:"connection-issues",children:e.jsxs("div",{className:"connection-issue",children:[e.jsx(M,{className:"connection-issue-icon connection-issue-icon--error"}),e.jsxs("div",{className:"connection-issue-content",children:[e.jsx("p",{className:"connection-issue-title connection-issue-title--error",children:"Unhealthy connections detected:"}),e.jsx("ul",{className:"connection-issue-list",children:d.map(l=>e.jsxs("li",{className:"connection-issue-item connection-issue-item--error",children:["• Device ",l.deviceId," - Last heartbeat: ",Math.round(l.timeSinceLastHeartbeat/1e3),"s ago"]},l.deviceId))})]})]})}),c&&m.length>0&&e.jsx("div",{className:"connection-issues",children:e.jsxs("div",{className:"connection-issue",children:[e.jsx(g,{className:"connection-issue-icon connection-issue-icon--warning"}),e.jsxs("div",{className:"connection-issue-content",children:[e.jsx("p",{className:"connection-issue-title connection-issue-title--warning",children:"Connection conflicts detected:"}),e.jsx("ul",{className:"connection-issue-list",children:m.map(l=>e.jsxs("li",{className:"connection-issue-item connection-issue-item--warning",children:["• ",l.deviceName," is connected to SpeedCoach"]},l.deviceId))})]})]})})]})},q=()=>{const{connectionStatus:n}=b(),{attemptReconnection:t}=F(),{getUnhealthyConnections:a}=y(),[s,h]=r.useState(new Map),[v,c]=r.useState(new Map),m=a(),j=async o=>{h(x=>new Map(x).set(o,!0));try{const x=await t(o);c(u=>new Map(u).set(o,x)),setTimeout(()=>{c(u=>{const l=new Map(u);return l.delete(o),l})},3e3)}catch(x){console.error("Manual reconnection failed:",x),c(u=>new Map(u).set(o,!1))}finally{h(x=>{const u=new Map(x);return u.delete(o),u})}},d=async()=>{for(const o of m)await j(o.deviceId)};return m.length===0?null:e.jsxs("div",{className:"card-base reconnection-status",children:[e.jsxs("div",{className:"reconnection-status-header",children:[e.jsxs("div",{className:"reconnection-status-title",children:[e.jsx(g,{className:"reconnection-status-icon"}),e.jsx("h3",{className:"reconnection-status-text",children:"Connection Issues Detected"})]}),m.length>1&&e.jsx("div",{className:"reconnection-status-actions",children:e.jsxs("button",{onClick:d,className:"btn btn-secondary",style:{color:"var(--status-error)",borderColor:"var(--status-error)"},children:[e.jsx(w,{className:"reconnection-icon"}),"Reconnect All"]})})]}),e.jsx("div",{className:"reconnection-device-list",children:m.map(o=>{const x=s.get(o.deviceId),u=v.get(o.deviceId),l=n.connectedDevices.find(i=>i.id===o.deviceId);return e.jsxs("div",{className:"reconnection-device-item",children:[e.jsxs("div",{className:"reconnection-device-info",children:[e.jsx("div",{className:"reconnection-device-indicator"}),e.jsxs("div",{className:"reconnection-device-details",children:[e.jsx("p",{className:"reconnection-device-name",children:l?.name||`Device ${o.deviceId}`}),e.jsxs("p",{className:"reconnection-device-timeout",children:["Last heartbeat: ",Math.round(o.timeSinceLastHeartbeat/1e3),"s ago"]})]})]}),e.jsxs("div",{className:"reconnection-device-actions",children:[u===!0&&e.jsxs("div",{className:"reconnection-result reconnection-result--success",children:[e.jsx(S,{className:"reconnection-result-icon"}),e.jsx("span",{className:"reconnection-result-text",children:"Reconnected"})]}),u===!1&&e.jsxs("div",{className:"reconnection-result reconnection-result--failure",children:[e.jsx(V,{className:"reconnection-result-icon"}),e.jsx("span",{className:"reconnection-result-text",children:"Failed"})]}),e.jsx("button",{onClick:()=>j(o.deviceId),disabled:x,className:"reconnection-button",children:x?e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"reconnection-button-icon reconnection-button-icon--spinning"}),"Reconnecting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"reconnection-button-icon"}),"Reconnect"]})})]})]},o.deviceId)})})]})},_=()=>{const{currentSession:n,rowers:t,connectionStatus:a,startSession:s,endSession:h,setUIState:v}=b(),{zones:c}=k(),{getUnhealthyConnections:m}=y(),j=W(n),d=n?.isActive,o=m(),x=()=>{if(t.length===0){v({currentView:"setup"});return}const i={id:`session-${Date.now()}`,startTime:new Date,rowers:t,heartRateData:[],isActive:!0};s(i)},u=()=>{h()},l=t.filter(i=>i.deviceId&&i.currentHeartRate);return e.jsxs("div",{className:"dashboard-container",children:[e.jsx("div",{className:"session-controls",children:e.jsxs("div",{className:"session-header",children:[e.jsxs("div",{className:"session-info",children:[e.jsx("h2",{className:"session-title",children:"Training Session"}),e.jsx("p",{className:"session-subtitle",children:d?`Started ${n?.startTime.toLocaleTimeString()}`:n&&!d?`Session ended - Duration: ${j}`:"Ready to start monitoring"}),d&&e.jsxs("div",{className:"session-status",children:[e.jsxs("div",{className:"status-indicator",children:[e.jsx(S,{className:"status-icon",style:{color:"var(--status-success)"}}),e.jsxs("span",{className:"status-text status-text--success",children:[l.length," rower(s) active"]})]}),e.jsx("div",{className:"status-indicator",children:e.jsxs("span",{className:"status-text status-text--info",children:["Duration: ",j]})}),o.length>0&&e.jsxs("div",{className:"status-indicator",children:[e.jsx(g,{className:"status-icon",style:{color:"var(--status-error)"}}),e.jsxs("span",{className:"status-text status-text--error",children:[o.length," connection(s) unhealthy"]})]})]})]}),e.jsxs("div",{className:"session-actions",children:[d?e.jsxs("button",{onClick:u,className:"btn btn-danger",children:[e.jsx(U,{className:"btn-icon"}),"End Session"]}):e.jsxs("button",{onClick:x,disabled:a.connectedDevices.length===0,className:"btn btn-primary",children:[e.jsx(B,{className:"btn-icon"}),"Start Session"]}),e.jsxs("button",{onClick:()=>v({currentView:"setup"}),className:"btn btn-secondary",children:[e.jsx(R,{className:"btn-icon"}),"Add Rower"]})]})]})}),e.jsx(X,{}),e.jsx(q,{}),t.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"rower-overview",children:[e.jsx("h3",{className:"rower-overview-title",children:"Rower Status"}),e.jsx("div",{className:"rower-grid",children:[1,2,3,4].map(i=>{const N=t.find(D=>D.seat===i),p=N&&N.deviceId&&N.currentHeartRate,f=N&&N.deviceId;return e.jsx("div",{className:`rower-seat ${p?"rower-seat--connected":f?"rower-seat--device-only":"rower-seat--empty"}`,children:e.jsxs("div",{className:"rower-seat-content",children:[e.jsx("div",{className:`rower-status-indicator ${p?"rower-status-indicator--connected":f?"rower-status-indicator--device-only":"rower-status-indicator--empty"}`}),e.jsxs("p",{className:"rower-seat-number",children:["Seat ",i]}),e.jsx("p",{className:"rower-name",children:N?N.name:"Empty"}),e.jsx("p",{className:"rower-status",children:p?"Active":f?"Connected":"No Device"})]})},i)})})]}),l.length>0&&e.jsx("div",{className:"heart-rate-grid",children:l.map(i=>e.jsx(P,{rower:i,zones:c},i.id))})]}):e.jsxs("div",{className:"card-base empty-state",children:[e.jsx(T,{className:"empty-state-icon"}),e.jsx("h3",{className:"empty-state-title",children:"No heart rate data"}),e.jsx("p",{className:"empty-state-description",children:"Connect heart rate devices and assign them to rowers to start monitoring."}),e.jsx("div",{className:"empty-state-action",children:e.jsxs("button",{onClick:()=>v({currentView:"setup"}),className:"btn btn-primary",children:[e.jsx(R,{className:"btn-icon"}),"Setup Devices"]})})]}),e.jsxs("div",{className:"card-base heart-rate-zones",children:[e.jsx("h3",{className:"heart-rate-zones-title",children:"Heart Rate Zones"}),e.jsx("div",{className:"heart-rate-zones-grid",children:Object.entries(c).map(([i,N])=>e.jsxs("div",{className:"heart-rate-zone-item",children:[e.jsx("div",{className:"heart-rate-zone-color",style:{backgroundColor:N.color}}),e.jsx("div",{className:"heart-rate-zone-name",children:N.name}),e.jsxs("div",{className:"heart-rate-zone-range",children:[N.min,"-",N.max," BPM"]})]},i))})]})]})};export{_ as Dashboard};
