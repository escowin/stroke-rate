import{j as e,F as D,a as W,b as Z,c as H,d as T,e as $,u as A,B as ee,f as O,g as se,h as ae,i as z,k as U}from"./index-BKQi3Haz.js";import{r,c as te,L as ne,C as re,X as ce,Y as ie,T as oe,d as le,e as de}from"./charts-BpM2RLF_.js";import{u as me,g as he,F as V,a as K,b as ue}from"./sessionAnalytics-aaUY-49P.js";import{F as S,a as xe}from"./LightBulbIcon-DBE7d1nF.js";import"./utils-DFjofOtR.js";import"./react-vendor-gH-7aFTg.js";import"./ui-vendor-D6OEOlG4.js";function je({title:a,titleId:o,...u},d){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:d,"aria-labelledby":o},u),a?r.createElement("title",{id:o},a):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 10.5h.375c.621 0 1.125.504 1.125 1.125v2.25c0 .621-.504 1.125-1.125 1.125H21M3.75 18h15A2.25 2.25 0 0 0 21 15.75v-6a2.25 2.25 0 0 0-2.25-2.25h-15A2.25 2.25 0 0 0 1.5 9.75v6A2.25 2.25 0 0 0 3.75 18Z"}))}const ve=r.forwardRef(je);function Ne({title:a,titleId:o,...u},d){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:d,"aria-labelledby":o},u),a?r.createElement("title",{id:o},a):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.5 6a7.5 7.5 0 1 0 7.5 7.5h-7.5V6Z"}),r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.5 10.5H21A7.5 7.5 0 0 0 13.5 3v7.5Z"}))}const _=r.forwardRef(Ne);function pe({title:a,titleId:o,...u},d){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:d,"aria-labelledby":o},u),a?r.createElement("title",{id:o},a):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))}const F=r.forwardRef(pe);function ge({title:a,titleId:o,...u},d){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:d,"aria-labelledby":o},u),a?r.createElement("title",{id:o},a):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z"}),r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"}))}const fe=r.forwardRef(ge);function be({title:a,titleId:o,...u},d){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:d,"aria-labelledby":o},u),a?r.createElement("title",{id:o},a):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.362 5.214A8.252 8.252 0 0 1 12 21 8.25 8.25 0 0 1 6.038 7.047 8.287 8.287 0 0 0 9 9.601a8.983 8.983 0 0 1 3.361-6.867 8.21 8.21 0 0 0 3 2.48Z"}),r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 18a3.75 3.75 0 0 0 .495-7.468 5.99 5.99 0 0 0-1.925 3.547 5.975 5.975 0 0 1-2.133-1.001A3.75 3.75 0 0 0 12 18Z"}))}const G=r.forwardRef(be);function we({title:a,titleId:o,...u},d){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:d,"aria-labelledby":o},u),a?r.createElement("title",{id:o},a):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347a1.125 1.125 0 0 1 0 1.972l-11.54 6.347a1.125 1.125 0 0 1-1.667-.986V5.653Z"}))}const ye=r.forwardRef(we);function Re({title:a,titleId:o,...u},d){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:d,"aria-labelledby":o},u),a?r.createElement("title",{id:o},a):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5.25 7.5A2.25 2.25 0 0 1 7.5 5.25h9a2.25 2.25 0 0 1 2.25 2.25v9a2.25 2.25 0 0 1-2.25 2.25h-9a2.25 2.25 0 0 1-2.25-2.25v-9Z"}))}const He=r.forwardRef(Re);function Se({title:a,titleId:o,...u},d){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:d,"aria-labelledby":o},u),a?r.createElement("title",{id:o},a):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))}const Ce=r.forwardRef(Se),Me=a=>{const[o,u]=r.useState("");return r.useEffect(()=>{if(!a){u("");return}const d=()=>{const g=new Date,v=a.startTime,h=(a.endTime||g).getTime()-v.getTime(),N=Math.floor(h/1e3),n=Math.floor(N/60),s=Math.floor(n/60),i=N%60,c=n%60;let l="";s>0?l=`${s}:${c.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`:l=`${c}:${i.toString().padStart(2,"0")}`,u(l)};d();let t=null;return a.isActive&&(t=setInterval(d,1e3)),()=>{t&&clearInterval(t)}},[a]),o},ke=({rower:a})=>{const{getZoneColor:o,getZoneName:u,zones:d}=me(a),t=a.currentHeartRate?.heartRate,g=t?u(t):"No Data",v=t?o(t):"#6b7280",m=a.currentHeartRate?.timestamp,h=()=>a.deviceId?t?{status:"connected",icon:Z,color:"text-green-500"}:{status:"connecting",icon:Z,color:"text-yellow-500"}:{status:"disconnected",icon:W,color:"text-gray-400"},N=()=>{const c=a.currentHeartRate?.batteryLevel;return c===void 0?{level:null,color:"text-gray-400"}:c<=20?{level:c,color:"text-red-500"}:c<=50?{level:c,color:"text-yellow-500"}:{level:c,color:"text-green-500"}},n=h(),s=N(),i=n.icon;return e.jsxs("article",{className:"heart-rate-card",children:[e.jsxs("header",{className:"heart-rate-card-header",children:[e.jsxs("div",{className:"heart-rate-card-info",children:[e.jsx("h3",{className:"heart-rate-card-name",children:a.name}),e.jsxs("p",{className:"heart-rate-card-seat",children:["Seat ",a.seat]})]}),e.jsxs("div",{className:"heart-rate-card-status",children:[e.jsx(i,{className:`heart-rate-card-status-icon ${n.status==="connected"?"heart-rate-card-status-icon--connected":n.status==="connecting"?"heart-rate-card-status-icon--connecting":"heart-rate-card-status-icon--disconnected"}`}),e.jsx(ve,{className:`heart-rate-card-battery-icon ${s.color}`})]})]}),e.jsxs("div",{className:"heart-rate-display",children:[e.jsxs("div",{className:"heart-rate-value-container",children:[e.jsx(D,{className:"heart-rate-icon"}),e.jsx("div",{className:"heart-rate-value",style:{color:v},children:t||"--"}),e.jsx("div",{className:"heart-rate-unit",children:"BPM"})]}),e.jsx("div",{className:"heart-rate-zone-badge",style:{backgroundColor:v},children:g})]}),t&&e.jsxs("div",{className:"heart-rate-zone-progress",children:[e.jsxs("label",{htmlFor:`progress-bar-${a.id}`,className:"heart-rate-zone-labels",children:[e.jsx("span",{children:d.recovery.min}),e.jsx("span",{children:d.anaerobic.max})]}),e.jsxs("progress",{id:`progress-bar-${a.id}`,className:"heart-rate-progress-bar",max:d.anaerobic.max-d.recovery.min,value:t-d.recovery.min,style:{"--zone-color":v},"aria-label":`Heart rate progress: ${t} BPM`,children:[t," BPM"]})]}),e.jsx("div",{className:"heart-rate-last-update",children:m?`Updated ${m.toLocaleTimeString()}`:"No data received"})]})},De={1:"#ef4444",2:"#3b82f6",3:"#10b981",4:"#f59e0b"},X=r.memo(({data:a,rowers:o,sessionStartTime:u,sessionEndTime:d})=>{const t=r.useMemo(()=>{if(a.length===0)return[];const s=[...a].sort((p,f)=>p.timestamp.getTime()-f.timestamp.getTime()),i=u?.getTime()||s[0].timestamp.getTime(),c=new Map;return s.forEach(p=>{const f=Math.floor((p.timestamp.getTime()-i)/1e3);c.has(f)||c.set(f,{});const j=c.get(f);j[`device_${p.deviceId}`]=p.heartRate,j.timestampStr=p.timestamp.toLocaleTimeString()}),Array.from(c.entries()).sort(([p],[f])=>p-f).map(([p,f])=>({duration:p,...f}))},[a,u?.getTime(),d?.getTime()]),{sessionDuration:g,xAxisTicks:v}=r.useMemo(()=>{if(t.length===0)return{sessionDuration:0,xAxisTicks:[]};let s;d&&u?s=Math.round((d.getTime()-u.getTime())/1e3):s=Math.max(...t.map(x=>x.duration))+1;const i=[0,Math.round(s*.25),Math.round(s*.5),Math.round(s*.75),s],c=[...new Set(i)].sort((l,x)=>l-x);return{sessionDuration:s,xAxisTicks:c}},[t,u,d]),m=r.useMemo(()=>o.filter(s=>s.deviceId&&a.some(i=>i.deviceId===s.deviceId)).sort((s,i)=>s.seat-i.seat),[o,a]),h=({active:s,payload:i})=>!s||!i||i.length===0?null:e.jsxs("article",{className:"heart-rate-tooltip",children:[e.jsxs("p",{className:"heart-rate-tooltip-title",children:["Time: ",i[0]?.payload?.timestampStr]}),i.map(c=>{const l=c.dataKey.replace("device_",""),x=m.find(p=>p.deviceId===l);return!x||c.value===void 0?null:e.jsxs("div",{className:"heart-rate-tooltip-item",children:[e.jsx("div",{className:"heart-rate-tooltip-indicator",style:{backgroundColor:c.color}}),e.jsxs("div",{children:[e.jsxs("p",{className:"heart-rate-tooltip-text",children:[x.name," (Seat ",x.seat,"): ",c.value," BPM"]}),e.jsxs("p",{className:"heart-rate-tooltip-text",children:["Zone: ",c.value<120?"Recovery":c.value<150?"Aerobic":c.value<170?"Threshold":"Anaerobic"]})]})]},c.dataKey)})]}),N=({payload:s})=>{if(!s||s.length===0)return null;const i=s.map(c=>{const l=c.dataKey.replace("device_",""),x=m.find(p=>p.deviceId===l);return{entry:c,rower:x}}).filter(c=>c.rower).sort((c,l)=>c.rower.seat-l.rower.seat);return e.jsx("div",{className:"heart-rate-legend",children:i.map(({entry:c,rower:l})=>e.jsxs("div",{className:"heart-rate-legend-item",children:[e.jsx("div",{className:"heart-rate-legend-indicator",style:{backgroundColor:c.color}}),e.jsxs("span",{className:"heart-rate-legend-text",children:[l.name," (Seat ",l.seat,")"]})]},c.dataKey))})},n=({viewBox:s})=>{const{x:i,y:c,width:l,height:x}=s;return e.jsxs("text",{x:i+l/2,y:c+x,textAnchor:"middle",fontSize:"12",fill:"var(--color-blue-light)",children:["Session Duration: ",g,"s"]})};return t.length===0?e.jsxs("section",{className:"heart-rate-chart",children:[e.jsx("h3",{className:"heart-rate-chart-title",children:"Heart Rate Trend"}),e.jsxs("article",{className:"heart-rate-chart-empty",children:[e.jsx("span",{className:"heart-rate-chart-empty-icon",children:"📈"}),e.jsx("p",{className:"heart-rate-chart-empty-text",children:"No session data available"}),e.jsx("p",{className:"heart-rate-chart-empty-subtext",children:"Complete a training session to see heart rate analysis"})]})]}):e.jsxs("section",{className:"heart-rate-chart",children:[e.jsxs("header",{className:"heart-rate-chart-header",children:[e.jsx("h3",{className:"heart-rate-chart-title",children:"Session Analysis"}),e.jsxs("div",{className:"heart-rate-chart-subtitle",children:[m.length," rower",m.length!==1?"s":""," active"]})]}),e.jsx("article",{className:"heart-rate-chart-container",children:e.jsx(te,{width:"100%",height:"100%",children:e.jsxs(ne,{data:t,children:[e.jsx(re,{strokeDasharray:"3 3",stroke:"var(--color-blue-light)"}),e.jsx(ce,{dataKey:"duration",tick:{fontSize:11,fill:"var(--color-blue-light)"},tickLine:{stroke:"var(--color-blue-light)"},axisLine:{stroke:"var(--color-blue-light)"},domain:[0,g],scale:"linear",ticks:v,label:e.jsx(n,{})}),e.jsx(ie,{domain:[80,200],tick:{fontSize:12,fill:"var(--color-blue-light)"},tickLine:{stroke:"var(--color-blue-light)"},axisLine:{stroke:"var(--color-blue-light)"}}),e.jsx(oe,{content:e.jsx(h,{})}),e.jsx(le,{content:e.jsx(N,{})}),m.map(s=>e.jsx(de,{type:"monotone",dataKey:`device_${s.deviceId}`,stroke:De[s.seat]||"#6b7280",strokeWidth:2,name:`${s.name} (Seat ${s.seat})`,connectNulls:!1,dot:!1,activeDot:{r:5,strokeWidth:2},animationDuration:1e3,animationEasing:"ease-out",isAnimationActive:!0},s.deviceId))]})})})]})},(a,o)=>a.data===o.data&&a.rowers===o.rowers&&a.sessionStartTime?.getTime()===o.sessionStartTime?.getTime()&&a.sessionEndTime?.getTime()===o.sessionEndTime?.getTime()),Te=({session:a,zones:o,className:u=""})=>{const d=r.useMemo(()=>he(a,o),[a,o]),{overallMetrics:t,rowerAnalytics:g,crewAnalysis:v,insights:m}=d,h=s=>s>=80?"text-green-600":s>=60?"text-yellow-600":"text-red-600",N=s=>s>=80?"bg-green-100":s>=60?"bg-yellow-100":"bg-red-100",n=s=>({recovery:"#10b981",aerobic:"#3b82f6",threshold:"#f59e0b",anaerobic:"#ef4444"})[s]||"#6b7280";return e.jsxs("div",{className:`session-analytics ${u}`,children:[e.jsxs("section",{className:"card-base analytics-overview",children:[e.jsxs("h3",{className:"card-title",children:[e.jsx(H,{className:"card-title-icon"}),"Session Analytics"]}),e.jsxs("div",{className:"analytics-overview-grid",children:[e.jsxs("div",{className:"analytics-metric-group",children:[e.jsx("h4",{className:"analytics-metric-group-title",children:"Basic Metrics"}),e.jsxs("div",{className:"analytics-metric-grid",children:[e.jsxs("div",{className:"analytics-metric",children:[e.jsx(D,{className:"analytics-metric-icon"}),e.jsxs("div",{className:"analytics-metric-content",children:[e.jsx("span",{className:"analytics-metric-value",children:t.avgHeartRate}),e.jsx("span",{className:"analytics-metric-label",children:"Avg BPM"})]})]}),e.jsxs("div",{className:"analytics-metric",children:[e.jsx(G,{className:"analytics-metric-icon"}),e.jsxs("div",{className:"analytics-metric-content",children:[e.jsx("span",{className:"analytics-metric-value",children:t.maxHeartRate}),e.jsx("span",{className:"analytics-metric-label",children:"Max BPM"})]})]}),e.jsxs("div",{className:"analytics-metric",children:[e.jsx(F,{className:"analytics-metric-icon"}),e.jsxs("div",{className:"analytics-metric-content",children:[e.jsx("span",{className:"analytics-metric-value",children:t.duration}),e.jsx("span",{className:"analytics-metric-label",children:"Duration (m)"})]})]})]})]}),e.jsxs("div",{className:"analytics-metric-group",children:[e.jsx("h4",{className:"analytics-metric-group-title",children:"Training Load"}),e.jsxs("div",{className:"analytics-metric-grid",children:[e.jsxs("div",{className:"analytics-metric",children:[e.jsx(S,{className:"analytics-metric-icon"}),e.jsxs("div",{className:"analytics-metric-content",children:[e.jsx("span",{className:"analytics-metric-value",children:t.trimp}),e.jsx("span",{className:"analytics-metric-label",children:"TRIMP"})]})]}),e.jsxs("div",{className:"analytics-metric",children:[e.jsx(S,{className:"analytics-metric-icon"}),e.jsxs("div",{className:"analytics-metric-content",children:[e.jsx("span",{className:"analytics-metric-value",children:t.tss}),e.jsx("span",{className:"analytics-metric-label",children:"TSS"})]})]}),e.jsxs("div",{className:"analytics-metric",children:[e.jsx(H,{className:"analytics-metric-icon"}),e.jsxs("div",{className:"analytics-metric-content",children:[e.jsx("span",{className:"analytics-metric-value",children:t.intensityFactor.toFixed(2)}),e.jsx("span",{className:"analytics-metric-label",children:"Intensity"})]})]})]})]})]})]}),e.jsxs("section",{className:"card-base performance-scores",children:[e.jsxs("h3",{className:"card-title",children:[e.jsx(S,{className:"card-title-icon"}),"Performance Scores"]}),e.jsxs("div",{className:"performance-scores-grid",children:[e.jsxs("div",{className:`performance-score ${N(t.performanceScore)}`,children:[e.jsxs("div",{className:"performance-score-header",children:[e.jsx("span",{className:"performance-score-label",children:"Performance"}),e.jsx("span",{className:`performance-score-value ${h(t.performanceScore)}`,children:t.performanceScore})]}),e.jsx("div",{className:"performance-score-bar",children:e.jsx("div",{className:"performance-score-fill",style:{width:`${t.performanceScore}%`,backgroundColor:h(t.performanceScore).replace("text-","")}})})]}),e.jsxs("div",{className:`performance-score ${N(t.consistencyScore)}`,children:[e.jsxs("div",{className:"performance-score-header",children:[e.jsx("span",{className:"performance-score-label",children:"Consistency"}),e.jsx("span",{className:`performance-score-value ${h(t.consistencyScore)}`,children:t.consistencyScore})]}),e.jsx("div",{className:"performance-score-bar",children:e.jsx("div",{className:"performance-score-fill",style:{width:`${t.consistencyScore}%`,backgroundColor:h(t.consistencyScore).replace("text-","")}})})]}),e.jsxs("div",{className:`performance-score ${N(t.effortScore)}`,children:[e.jsxs("div",{className:"performance-score-header",children:[e.jsx("span",{className:"performance-score-label",children:"Effort"}),e.jsx("span",{className:`performance-score-value ${h(t.effortScore)}`,children:t.effortScore})]}),e.jsx("div",{className:"performance-score-bar",children:e.jsx("div",{className:"performance-score-fill",style:{width:`${t.effortScore}%`,backgroundColor:h(t.effortScore).replace("text-","")}})})]}),e.jsxs("div",{className:`performance-score ${N(t.recoveryScore)}`,children:[e.jsxs("div",{className:"performance-score-header",children:[e.jsx("span",{className:"performance-score-label",children:"Recovery"}),e.jsx("span",{className:`performance-score-value ${h(t.recoveryScore)}`,children:t.recoveryScore})]}),e.jsx("div",{className:"performance-score-bar",children:e.jsx("div",{className:"performance-score-fill",style:{width:`${t.recoveryScore}%`,backgroundColor:h(t.recoveryScore).replace("text-","")}})})]})]})]}),e.jsxs("section",{className:"card-base zone-analysis",children:[e.jsxs("h3",{className:"card-title",children:[e.jsx(H,{className:"card-title-icon"}),"Heart Rate Zone Analysis"]}),e.jsx("div",{className:"zone-analysis-content",children:e.jsxs("div",{className:"zone-distribution",children:[e.jsx("h4",{className:"zone-distribution-title",children:"Time Distribution"}),e.jsx("div",{className:"zone-distribution-bars",children:Object.entries(t.zoneDistribution).map(([s,i])=>e.jsxs("div",{className:"zone-distribution-bar",children:[e.jsxs("div",{className:"zone-distribution-bar-header",children:[e.jsx("span",{className:"zone-distribution-bar-color",style:{backgroundColor:n(s)}}),e.jsx("span",{className:"zone-distribution-bar-label",children:s.charAt(0).toUpperCase()+s.slice(1)}),e.jsxs("span",{className:"zone-distribution-bar-percentage",children:[i,"%"]})]}),e.jsx("div",{className:"zone-distribution-bar-track",children:e.jsx("div",{className:"zone-distribution-bar-fill",style:{width:`${i}%`,backgroundColor:n(s)}})}),e.jsxs("div",{className:"zone-distribution-bar-time",children:[t.timeInZones[s],"m"]})]},s))})]})})]}),e.jsxs("section",{className:"card-base crew-analysis",children:[e.jsxs("h3",{className:"card-title",children:[e.jsx(V,{className:"card-title-icon"}),"Crew Analysis"]}),e.jsxs("div",{className:"crew-analysis-content",children:[e.jsxs("div",{className:"crew-metrics",children:[e.jsxs("div",{className:"crew-metric",children:[e.jsx("span",{className:"crew-metric-label",children:"Synchronization"}),e.jsxs("div",{className:"crew-metric-value",children:[e.jsx("span",{className:`crew-metric-score ${h(t.crewSynchronization)}`,children:t.crewSynchronization}),e.jsx("span",{className:"crew-metric-unit",children:"/100"})]})]}),e.jsxs("div",{className:"crew-metric",children:[e.jsx("span",{className:"crew-metric-label",children:"Cohesion"}),e.jsxs("div",{className:"crew-metric-value",children:[e.jsx("span",{className:`crew-metric-score ${h(t.crewCohesion)}`,children:t.crewCohesion}),e.jsx("span",{className:"crew-metric-unit",children:"/100"})]})]})]}),e.jsxs("div",{className:"rower-performance",children:[e.jsx("h4",{className:"rower-performance-title",children:"Individual Performance"}),e.jsx("div",{className:"rower-performance-grid",children:g.map(s=>e.jsxs("div",{className:"rower-performance-card",children:[e.jsxs("div",{className:"rower-performance-header",children:[e.jsx("span",{className:"rower-performance-name",children:s.rowerName}),e.jsxs("span",{className:"rower-performance-seat",children:["Seat ",s.seat]})]}),e.jsxs("div",{className:"rower-performance-metrics",children:[e.jsxs("div",{className:"rower-performance-metric",children:[e.jsx(D,{className:"rower-performance-metric-icon"}),e.jsx("span",{className:"rower-performance-metric-value",children:s.metrics.avgHeartRate}),e.jsx("span",{className:"rower-performance-metric-label",children:"Avg BPM"})]}),e.jsxs("div",{className:"rower-performance-metric",children:[e.jsx(S,{className:"rower-performance-metric-icon"}),e.jsx("span",{className:"rower-performance-metric-value",children:s.metrics.trimp}),e.jsx("span",{className:"rower-performance-metric-label",children:"TRIMP"})]}),e.jsxs("div",{className:"rower-performance-metric",children:[e.jsx(H,{className:"rower-performance-metric-icon"}),e.jsx("span",{className:`rower-performance-metric-value ${h(s.metrics.consistencyScore)}`,children:s.metrics.consistencyScore}),e.jsx("span",{className:"rower-performance-metric-label",children:"Consistency"})]})]})]},s.rowerId))})]})]})]}),e.jsxs("section",{className:"card-base training-insights",children:[e.jsxs("h3",{className:"card-title",children:[e.jsx(xe,{className:"card-title-icon"}),"Training Insights"]}),e.jsxs("div",{className:"training-insights-content",children:[e.jsxs("div",{className:"insight-section",children:[e.jsx("h4",{className:"insight-section-title",children:"Primary Training Zone"}),e.jsxs("div",{className:"insight-primary-zone",children:[e.jsx("span",{className:"insight-zone-indicator",style:{backgroundColor:n(m.primaryTrainingZone)}}),e.jsx("span",{className:"insight-zone-name",children:m.primaryTrainingZone.charAt(0).toUpperCase()+m.primaryTrainingZone.slice(1)}),e.jsxs("span",{className:"insight-zone-effectiveness",children:[m.trainingEffectiveness,"% effectiveness"]})]})]}),m.strengths.length>0&&e.jsxs("div",{className:"insight-section",children:[e.jsxs("h4",{className:"insight-section-title",children:[e.jsx(T,{className:"insight-section-icon"}),"Strengths"]}),e.jsx("ul",{className:"insight-list",children:m.strengths.map((s,i)=>e.jsx("li",{className:"insight-item strength",children:s},i))})]}),m.improvementAreas.length>0&&e.jsxs("div",{className:"insight-section",children:[e.jsxs("h4",{className:"insight-section-title",children:[e.jsx($,{className:"insight-section-icon"}),"Areas for Improvement"]}),e.jsx("ul",{className:"insight-list",children:m.improvementAreas.map((s,i)=>e.jsx("li",{className:"insight-item improvement",children:s},i))})]}),v.recommendations.length>0&&e.jsxs("div",{className:"insight-section",children:[e.jsxs("h4",{className:"insight-section-title",children:[e.jsx(V,{className:"insight-section-icon"}),"Crew Recommendations"]}),e.jsx("ul",{className:"insight-list",children:v.recommendations.map((s,i)=>e.jsx("li",{className:"insight-item recommendation",children:s},i))})]})]})]}),e.jsxs("section",{className:"card-base recovery-info",children:[e.jsxs("h3",{className:"card-title",children:[e.jsx(F,{className:"card-title-icon"}),"Recovery Information"]}),e.jsxs("div",{className:"recovery-info-content",children:[e.jsxs("div",{className:"recovery-metric",children:[e.jsx("span",{className:"recovery-metric-label",children:"Estimated Recovery Time"}),e.jsxs("span",{className:"recovery-metric-value",children:[t.recoveryTime,"h"]})]}),e.jsxs("div",{className:"recovery-metric",children:[e.jsx("span",{className:"recovery-metric-label",children:"Heart Rate Variability"}),e.jsx("span",{className:"recovery-metric-value",children:t.heartRateVariability})]}),e.jsxs("div",{className:"recovery-metric",children:[e.jsx("span",{className:"recovery-metric-label",children:"Recovery Score"}),e.jsxs("span",{className:`recovery-metric-value ${h(t.recoveryScore)}`,children:[t.recoveryScore,"/100"]})]})]})]})]})},$e={recovery:"#10b981",aerobic:"#3b82f6",threshold:"#f59e0b",anaerobic:"#ef4444"},Ae=({currentSession:a})=>{const{zones:o}=K(),{sessions:u}=ue(),[d,t]=r.useState(null),[g,v]=r.useState(!1),m=r.useMemo(()=>{if(!a?.finalHeartRateData||a.finalHeartRateData.length===0)return null;const n=a.finalHeartRateData,s=n.map(j=>j.heartRate),i=Math.round(s.reduce((j,b)=>j+b,0)/s.length),c=Math.max(...s),l=Math.min(...s),x=a.rowers.map(j=>{const b=n.filter(y=>y.deviceId===j.deviceId);if(b.length===0)return null;const w=b.map(y=>y.heartRate),C=Math.round(w.reduce((y,R)=>y+R,0)/w.length),M=Math.max(...w),E=Math.min(...w),k={recovery:0,aerobic:0,threshold:0,anaerobic:0};b.forEach(y=>{const R=y.heartRate;R>=o.anaerobic.min?k.anaerobic++:R>=o.threshold.min?k.threshold++:R>=o.aerobic.min?k.aerobic++:k.recovery++});const I=b.length,Y=a.endTime?Math.floor((a.endTime.getTime()-a.startTime.getTime())/1e3):0,J=Object.entries(k).map(([y,R])=>{const Q=I>0?Math.round(R/I*100):0,L=I>0?Math.round(R/I*Y):0,B=Math.floor(L/60),P=L%60;return{zone:y,count:R,percentage:Q,durationSeconds:L,durationFormatted:B>0?`${B}m ${P}s`:`${P}s`}});return{rower:j,avgHeartRate:C,maxHeartRate:M,minHeartRate:E,dataPoints:b.length,zoneBreakdown:J}}).filter(Boolean),p=n.length,f={recovery:n.filter(j=>j.heartRate<o.aerobic.min).length,aerobic:n.filter(j=>j.heartRate>=o.aerobic.min&&j.heartRate<o.threshold.min).length,threshold:n.filter(j=>j.heartRate>=o.threshold.min&&j.heartRate<o.anaerobic.min).length,anaerobic:n.filter(j=>j.heartRate>=o.anaerobic.min).length};return{avgHeartRate:i,maxHeartRate:c,minHeartRate:l,totalDataPoints:p,zoneTime:f,rowerMetrics:x,sessionDuration:a.endTime?Math.floor((a.endTime.getTime()-a.startTime.getTime())/1e3/60):0}},[a,o]),h=r.useMemo(()=>{if(!d||!u||!m)return null;const n=u.find(j=>j.id===d);if(!n||!n.finalHeartRateData)return null;const s=n.finalHeartRateData,i=Math.round(s.reduce((j,b)=>j+b.heartRate,0)/s.length),c=Math.max(...s.map(j=>j.heartRate)),l=n.endTime?Math.floor((n.endTime.getTime()-n.startTime.getTime())/1e3/60):0,x=Math.round((m.avgHeartRate-i)/i*100),p=Math.round((m.maxHeartRate-c)/c*100),f=l>0?Math.round((m.sessionDuration-l)/l*100):0;return{avgHeartRate:x,maxHeartRate:p,duration:f}},[d,u,m]),N=r.useMemo(()=>{if(!d||!u||!m?.rowerMetrics)return null;const n=u.find(s=>s.id===d);return!n||!n.finalHeartRateData?null:m.rowerMetrics.map(s=>{if(!s)return null;const i=n.finalHeartRateData.filter(f=>f.deviceId===s.rower.deviceId);if(i.length===0)return null;const c=Math.round(i.reduce((f,j)=>f+j.heartRate,0)/i.length),l=Math.max(...i.map(f=>f.heartRate)),x=Math.round((s.avgHeartRate-c)/c*100),p=Math.round((s.maxHeartRate-l)/l*100);return{rowerId:s.rower.id,avgHeartRate:x,maxHeartRate:p}}).filter(Boolean)},[d,u,m]);return a?e.jsxs("section",{className:"enhanced-dashboard",children:[m&&e.jsxs("section",{className:"card-base performance-metrics",children:[e.jsxs("h3",{className:"card-title",children:[e.jsx(S,{className:"card-title-icon"}),"Performance Metrics"]}),e.jsxs("div",{className:"metrics-grid",children:[e.jsxs("div",{className:"metric-item",children:[e.jsx(D,{className:"metric-icon"}),e.jsxs("div",{className:"metric-content",children:[e.jsx("p",{className:"metric-value",children:m.avgHeartRate}),e.jsx("p",{className:"metric-label",children:"Avg BPM"}),h&&e.jsxs("div",{className:`progress-indicator ${h.avgHeartRate===0?"neutral":h.avgHeartRate<0?"improvement":"decline"}`,children:[e.jsx("span",{className:"progress-icon",children:h.avgHeartRate===0?"—":h.avgHeartRate<0?"↗":"↘"}),e.jsxs("span",{className:"progress-text",children:[Math.abs(h.avgHeartRate),"%"]})]})]})]}),e.jsxs("div",{className:"metric-item",children:[e.jsx(G,{className:"metric-icon"}),e.jsxs("div",{className:"metric-content",children:[e.jsx("p",{className:"metric-value",children:m.maxHeartRate}),e.jsx("p",{className:"metric-label",children:"Max BPM"}),h&&e.jsxs("div",{className:`progress-indicator ${h.maxHeartRate===0?"neutral":h.maxHeartRate<0?"improvement":"decline"}`,children:[e.jsx("span",{className:"progress-icon",children:h.maxHeartRate===0?"—":h.maxHeartRate<0?"↗":"↘"}),e.jsxs("span",{className:"progress-text",children:[Math.abs(h.maxHeartRate),"%"]})]})]})]}),e.jsxs("div",{className:"metric-item",children:[e.jsx(F,{className:"metric-icon"}),e.jsxs("div",{className:"metric-content",children:[e.jsxs("p",{className:"metric-value",children:[m.sessionDuration,"m"]}),e.jsx("p",{className:"metric-label",children:"Duration"}),h&&e.jsxs("div",{className:`progress-indicator ${h.duration===0?"neutral":h.duration>0?"improvement":"decline"}`,children:[e.jsx("span",{className:"progress-icon",children:h.duration===0?"—":h.duration>0?"↗":"↘"}),e.jsxs("span",{className:"progress-text",children:[Math.abs(h.duration),"%"]})]})]})]}),e.jsxs("div",{className:"metric-item",children:[e.jsx(H,{className:"metric-icon"}),e.jsxs("div",{className:"metric-content",children:[e.jsx("p",{className:"metric-value",children:m.totalDataPoints}),e.jsx("p",{className:"metric-label",children:"Data Points"})]})]})]})]}),m?.rowerMetrics&&m.rowerMetrics.length>0&&e.jsxs("section",{className:"card-base rower-metrics",children:[e.jsxs("h3",{className:"card-title",children:[e.jsx(D,{className:"card-title-icon"}),"Individual Rower Performance"]}),e.jsx("div",{className:"rower-metrics-grid",children:m.rowerMetrics.map(n=>n?e.jsxs("div",{className:"rower-metric-card",children:[e.jsxs("div",{className:"rower-metric-header",children:[e.jsx("h4",{className:"rower-metric-name",children:n.rower.name}),e.jsxs("span",{className:"rower-metric-seat",children:["Seat ",n.rower.seat]})]}),e.jsxs("div",{className:"rower-metric-stats",children:[e.jsxs("div",{className:"rower-metric-stat",children:[e.jsx("span",{className:"rower-metric-stat-value",children:n.avgHeartRate}),e.jsx("span",{className:"rower-metric-stat-label",children:"Avg BPM"}),N&&(()=>{const s=N.find(i=>i?.rowerId===n.rower.id);return s?e.jsxs("div",{className:`progress-indicator ${s.avgHeartRate===0?"neutral":s.avgHeartRate<0?"improvement":"decline"}`,children:[e.jsx("span",{className:"progress-icon",children:s.avgHeartRate===0?"—":s.avgHeartRate<0?"↗":"↘"}),e.jsxs("span",{className:"progress-text",children:[Math.abs(s.avgHeartRate),"%"]})]}):null})()]}),e.jsxs("div",{className:"rower-metric-stat",children:[e.jsx("span",{className:"rower-metric-stat-value",children:n.maxHeartRate}),e.jsx("span",{className:"rower-metric-stat-label",children:"Max BPM"}),N&&(()=>{const s=N.find(i=>i?.rowerId===n.rower.id);return s?e.jsxs("div",{className:`progress-indicator ${s.maxHeartRate===0?"neutral":s.maxHeartRate<0?"improvement":"decline"}`,children:[e.jsx("span",{className:"progress-icon",children:s.maxHeartRate===0?"—":s.maxHeartRate<0?"↗":"↘"}),e.jsxs("span",{className:"progress-text",children:[Math.abs(s.maxHeartRate),"%"]})]}):null})()]}),e.jsxs("div",{className:"rower-metric-stat",children:[e.jsx("span",{className:"rower-metric-stat-value",children:n.dataPoints}),e.jsx("span",{className:"rower-metric-stat-label",children:"Data Points"})]})]}),e.jsxs("div",{className:"rower-zone-breakdown",children:[e.jsx("h5",{className:"rower-zone-breakdown-title",children:"Heart Rate Zones"}),e.jsx("div",{className:"rower-zone-list",children:n.zoneBreakdown.map(s=>e.jsxs("div",{className:"rower-zone-item",children:[e.jsxs("div",{className:"rower-zone-header",children:[e.jsx("span",{className:"rower-zone-color",style:{backgroundColor:$e[s.zone]}}),e.jsx("span",{className:"rower-zone-name",children:s.zone.charAt(0).toUpperCase()+s.zone.slice(1)})]}),e.jsxs("div",{className:"rower-zone-details",children:[e.jsxs("span",{className:"rower-zone-percentage",children:[s.percentage,"%"]}),e.jsx("span",{className:"rower-zone-duration",children:s.durationFormatted})]})]},s.zone))})]})]},n.rower.id):null)})]}),a&&!a.isActive&&a.finalHeartRateData&&a.finalHeartRateData.length>0&&e.jsx(X,{data:a.finalHeartRateData,rowers:a.rowers,sessionStartTime:a.startTime,sessionEndTime:a.endTime}),u&&u.length>0&&e.jsxs("section",{className:"card-base session-selection",children:[e.jsxs("h3",{className:"card-title",children:[e.jsx(S,{className:"card-title-icon"}),"Compare with Previous Session"]}),e.jsx("div",{className:"session-selection-grid",children:u.filter(n=>n.id!==a.id).map(n=>e.jsx("div",{className:`session-selection-card ${d===n.id?"selected":""}`,onClick:()=>t(d===n.id?null:n.id),children:e.jsxs("div",{className:"session-selection-header",children:[e.jsx("input",{type:"radio",name:"session-comparison",checked:d===n.id,onChange:()=>t(d===n.id?null:n.id),className:"session-selection-radio"}),e.jsxs("div",{className:"session-selection-info",children:[e.jsxs("span",{className:"session-selection-date",children:[n.startTime.toLocaleDateString()," ",n.startTime.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]}),e.jsxs("span",{className:"session-selection-details",children:[n.rowers.length," rowers • ",n.finalHeartRateData?.length||0," data points"]})]})]})},n.id))})]}),a&&!a.isActive&&a.finalHeartRateData&&a.finalHeartRateData.length>0&&e.jsx("section",{className:"card-base analytics-toggle",children:e.jsxs("div",{className:"analytics-toggle-content",children:[e.jsxs("h3",{className:"analytics-toggle-title",children:[e.jsx(_,{className:"analytics-toggle-icon"}),"Advanced Session Analytics"]}),e.jsx("p",{className:"analytics-toggle-description",children:"View detailed training analysis including TRIMP, TSS, recovery metrics, and crew synchronization"}),e.jsx("button",{className:`analytics-toggle-button ${g?"active":""}`,onClick:()=>v(!g),children:g?"Hide Analytics":"Show Analytics"})]})}),g&&a&&!a.isActive&&a.finalHeartRateData&&a.finalHeartRateData.length>0&&e.jsx(Te,{session:a,zones:o})]}):e.jsxs("section",{className:"card-base empty-state",children:[e.jsx(H,{className:"empty-state-icon"}),e.jsx("h3",{className:"empty-state-title",children:"No Active Session"}),e.jsx("p",{className:"empty-state-description",children:"Start a training session to view enhanced analytics and trends."})]})},q=()=>{const[a,o]=r.useState(new Map),[u,d]=r.useState(!1),t=ee.getInstance(),{connectionStatus:g}=A(),v=r.useCallback(()=>{const l=new Map,x=t.getAllConnectionHealth();for(const[p,f]of x){const j=Date.now()-f.lastHeartbeat.getTime(),b=t.isConnectionHealthy(p);l.set(p,{deviceId:p,isHealthy:b,lastHeartbeat:f.lastHeartbeat,timeSinceLastHeartbeat:j})}o(l)},[t]),m=r.useCallback(()=>{d(!0),t.startConnectionHealthMonitoring();const l=setInterval(v,5e3);return()=>{clearInterval(l),t.stopConnectionHealthMonitoring(),d(!1)}},[t,v]),h=r.useCallback(()=>{t.stopConnectionHealthMonitoring(),d(!1)},[t]),N=r.useCallback(l=>a.get(l),[a]),n=r.useCallback(()=>Array.from(a.values()).filter(l=>!l.isHealthy),[a]),s=r.useCallback(()=>{const l=a.size,x=Array.from(a.values()).filter(f=>f.isHealthy).length,p=l-x;return{total:l,healthy:x,unhealthy:p,healthPercentage:l>0?Math.round(x/l*100):100}},[a]),i=r.useMemo(()=>{const l=new Map;for(const[x,p]of a)p.isHealthy?l.set(x,{status:"healthy",color:"green"}):l.set(x,{status:"unhealthy",color:"red"});return l},[a]),c=r.useCallback(l=>i.get(l)||{status:"unknown",color:"gray"},[i]);return r.useEffect(()=>{if(g.connectedDevices.length>0){t.startConnectionHealthMonitoring(),v();const x=setInterval(v,5e3);return()=>{clearInterval(x),t.stopConnectionHealthMonitoring()}}else t.stopConnectionHealthMonitoring()},[g.connectedDevices.length,t,v]),r.useEffect(()=>{d(g.connectedDevices.length>0)},[g.connectedDevices.length]),{connectionHealth:a,isMonitoring:u,startMonitoring:m,stopMonitoring:h,getDeviceHealth:N,getDeviceHealthStatus:c,getUnhealthyConnections:n,getHealthSummary:s,updateHealthData:v}},Ie=()=>{const{connectionStatus:a}=A(),{getHealthSummary:o,getUnhealthyConnections:u}=q(),{isScanning:d,connectedDevices:t,availableDevices:g,hasSpeedCoachConflicts:v,conflicts:m}=a,h=o(),N=u(),n=()=>v?$:N.length>0?O:t.length>0?T:d?se:W,s=()=>v?"SpeedCoach conflicts detected":N.length>0?`${N.length} connection(s) unhealthy`:t.length>0?`${t.length} device(s) connected (${h.healthPercentage}% healthy)`:d?"Scanning for devices...":"No devices connected",i=n();return e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:"connection-status-content",children:[e.jsxs("article",{className:"connection-status-info",children:[e.jsx(i,{className:`connection-status-icon ${v?"connection-status-icon--conflict":N.length>0?"connection-status-icon--unhealthy":t.length>0?"connection-status-icon--connected":d?"connection-status-icon--scanning":"connection-status-icon--disconnected"}`}),e.jsxs("div",{children:[e.jsx("p",{className:`connection-status-text ${v?"connection-status-text--conflict":N.length>0?"connection-status-text--unhealthy":t.length>0?"connection-status-text--connected":d?"connection-status-text--scanning":"connection-status-text--disconnected"}`,children:s()}),g.length>0&&e.jsxs("p",{className:"connection-status-subtitle",children:[g.length," device(s) available"]})]})]}),t.length>0&&e.jsx("ul",{className:"connection-device-list",children:t.map(c=>{const l=c.isHealthy!==!1;return e.jsxs("li",{className:`connection-device-item ${l?"connection-device-item--healthy":"connection-device-item--unhealthy"}`,children:[e.jsx("div",{className:`connection-device-indicator ${l?"connection-device-indicator--healthy":"connection-device-indicator--unhealthy"}`}),e.jsx("p",{className:`connection-device-name ${l?"connection-device-name--healthy":"connection-device-name--unhealthy"}`,children:c.name})]},c.id)})})]}),N.length>0&&e.jsx("section",{className:"connection-issues",children:e.jsxs("article",{className:"connection-issue",children:[e.jsx(O,{className:"connection-issue-icon connection-issue-icon--error"}),e.jsxs("div",{className:"connection-issue-content",children:[e.jsx("p",{className:"connection-issue-title connection-issue-title--error",children:"Unhealthy connections detected:"}),e.jsx("ul",{className:"connection-issue-list",children:N.map(c=>e.jsxs("li",{className:"connection-issue-item connection-issue-item--error",children:["• Device ",c.deviceId," - Last heartbeat: ",Math.round(c.timeSinceLastHeartbeat/1e3),"s ago"]},c.deviceId))})]})]})}),v&&m.length>0&&e.jsx("section",{className:"connection-issues",children:e.jsxs("article",{className:"connection-issue",children:[e.jsx($,{className:"connection-issue-icon connection-issue-icon--warning"}),e.jsxs("div",{className:"connection-issue-content",children:[e.jsx("p",{className:"connection-issue-title connection-issue-title--warning",children:"Connection conflicts detected:"}),e.jsx("ul",{className:"connection-issue-list",children:m.map(c=>e.jsxs("li",{className:"connection-issue-item connection-issue-item--warning",children:["• ",c.deviceName," is connected to SpeedCoach"]},c.deviceId))})]})]})})]})},Ee=()=>{const{connectionStatus:a}=A(),{attemptReconnection:o}=ae(),{getUnhealthyConnections:u}=q(),[d,t]=r.useState(new Map),[g,v]=r.useState(new Map),m=u(),h=async n=>{t(s=>new Map(s).set(n,!0));try{const s=await o(n);v(i=>new Map(i).set(n,s)),setTimeout(()=>{v(i=>{const c=new Map(i);return c.delete(n),c})},3e3)}catch(s){console.error("Manual reconnection failed:",s),v(i=>new Map(i).set(n,!1))}finally{t(s=>{const i=new Map(s);return i.delete(n),i})}},N=async()=>{for(const n of m)await h(n.deviceId)};return m.length===0?null:e.jsxs("section",{className:"card-base reconnection-status",children:[e.jsxs("article",{className:"reconnection-status-header",children:[e.jsxs("div",{className:"reconnection-status-title",children:[e.jsx($,{className:"reconnection-status-icon"}),e.jsx("h3",{className:"reconnection-status-text",children:"Connection Issues Detected"})]}),m.length>1&&e.jsx("div",{className:"reconnection-status-actions",children:e.jsxs("button",{onClick:N,className:"btn btn-secondary",style:{color:"var(--status-error)",borderColor:"var(--status-error)"},children:[e.jsx(z,{className:"reconnection-icon"}),"Reconnect All"]})})]}),e.jsx("ul",{className:"reconnection-device-list",children:m.map(n=>{const s=d.get(n.deviceId),i=g.get(n.deviceId),c=a.connectedDevices.find(l=>l.id===n.deviceId);return e.jsxs("li",{className:"reconnection-device-item",children:[e.jsxs("div",{className:"reconnection-device-info",children:[e.jsx("div",{className:"reconnection-device-indicator"}),e.jsxs("div",{className:"reconnection-device-details",children:[e.jsx("p",{className:"reconnection-device-name",children:c?.name||`Device ${n.deviceId}`}),e.jsxs("p",{className:"reconnection-device-timeout",children:["Last heartbeat: ",Math.round(n.timeSinceLastHeartbeat/1e3),"s ago"]})]})]}),e.jsxs("div",{className:"reconnection-device-actions",children:[i===!0&&e.jsxs("div",{className:"reconnection-result reconnection-result--success",children:[e.jsx(T,{className:"reconnection-result-icon"}),e.jsx("span",{className:"reconnection-result-text",children:"Reconnected"})]}),i===!1&&e.jsxs("div",{className:"reconnection-result reconnection-result--failure",children:[e.jsx(Ce,{className:"reconnection-result-icon"}),e.jsx("span",{className:"reconnection-result-text",children:"Failed"})]}),e.jsx("button",{onClick:()=>h(n.deviceId),disabled:s,className:"reconnection-button",children:s?e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"reconnection-button-icon reconnection-button-icon--spinning"}),"Reconnecting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"reconnection-button-icon"}),"Reconnect"]})})]})]},n.deviceId)})})]})},Le=()=>!1,ze=()=>Le(),Fe=()=>{const{rowers:a,currentSession:o,startSession:u,endSession:d,updateHeartRate:t,addRower:g,removeAllRowers:v,setConnectionStatus:m,addConnectedDevice:h,removeAllConnectedDevices:N,clearHeartRateData:n}=A(),[s,i]=r.useState(ze()),[c,l]=r.useState(null),[x,p]=r.useState(!1);return null},Ke=()=>{const{currentSession:a,rowers:o,connectionStatus:u,startSession:d,endSession:t,setUIState:g,getUnhealthyDevices:v,sessionWasRestored:m}=A(),{zones:h}=K(),N=Me(a),n=a?.isActive,[s,i]=r.useState(!1),[c,l]=r.useState(!1),x=v();r.useEffect(()=>{m&&a&&(l(!0),setTimeout(()=>l(!1),5e3))},[m,a]);const p=()=>{if(o.length===0){g({currentView:"setup"});return}l(!1);const b={id:`session-${Date.now()}`,startTime:new Date,rowers:o,heartRateData:[],isActive:!0};d(b)},f=()=>{t()},j=o.filter(b=>b.deviceId&&b.currentHeartRate);return e.jsxs(e.Fragment,{children:[e.jsx(Fe,{}),e.jsxs("section",{className:"session-controls",children:[c&&e.jsxs("div",{className:"session-restoration-notification",children:[e.jsx(T,{className:"restoration-icon"}),e.jsx("span",{children:"Session restored from previous session"})]}),e.jsxs("article",{className:"session-info",children:[e.jsx("h2",{className:"session-title",children:"Training Session"}),e.jsx("p",{className:"session-subtitle",children:n?`Started ${a?.startTime.toLocaleTimeString()}`:a&&!n?`Session ended - Duration: ${N}`:"Ready to start monitoring"}),n&&e.jsxs("div",{className:"session-status",children:[e.jsxs("p",{className:"status-indicator",children:[e.jsx(T,{className:"status-icon"}),e.jsxs("span",{className:"status-text status-text--success",children:[j.length," rower(s) active"]})]}),e.jsx("p",{className:"status-indicator",children:e.jsxs("span",{className:"status-text status-text--info",children:["Duration: ",N]})}),x.length>0&&e.jsxs("p",{className:"status-indicator",children:[e.jsx($,{className:"status-icon"}),e.jsxs("span",{className:"status-text status-text--error",children:[x.length," connection(s) unhealthy"]})]})]})]}),e.jsxs("article",{className:"session-actions",children:[n?e.jsxs("button",{onClick:f,className:"btn btn-danger",children:[e.jsx(He,{className:"btn-icon"}),"End Session"]}):e.jsxs("button",{onClick:p,disabled:u.connectedDevices.length===0,className:"btn btn-primary",children:[e.jsx(ye,{className:"btn-icon"}),"Start Session"]}),e.jsxs("button",{onClick:()=>g({currentView:"setup"}),className:"btn btn-secondary",children:[e.jsx(U,{className:"btn-icon"}),"Add Rower"]}),a&&e.jsx("button",{onClick:()=>i(!s),className:`btn ${s?"btn-primary":"btn-secondary"}`,children:s?e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"btn-icon"}),"Basic View"]}):e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"btn-icon"}),"Enhanced View"]})})]})]}),e.jsx(Ie,{}),e.jsx(Ee,{}),o.length>0?e.jsx(e.Fragment,{children:s&&a?e.jsx(Ae,{currentSession:a}):e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:"rower-overview",children:[e.jsx("h3",{className:"rower-overview-title",children:"Rower Status"}),e.jsx("article",{className:"rower-grid",children:[1,2,3,4].map(b=>{const w=o.find(E=>E.seat===b),C=w&&w.deviceId&&w.currentHeartRate,M=w&&w.deviceId;return e.jsxs("div",{className:`rower-seat ${C?"rower-seat--connected":M?"rower-seat--device-only":"rower-seat--empty"}`,children:[e.jsx("span",{className:`rower-status-indicator ${C?"rower-status-indicator--connected":M?"rower-status-indicator--device-only":"rower-status-indicator--empty"}`}),e.jsxs("p",{className:"rower-seat-number",children:["Seat ",b]}),e.jsx("p",{className:"rower-name",children:w?w.name:"Empty"}),e.jsx("p",{className:"rower-status",children:C?"Active":M?"Connected":"No Device"})]},b)})})]}),j.length>0&&e.jsx("section",{className:"heart-rate-grid",children:j.map(b=>e.jsx(ke,{rower:b,zones:h},b.id))}),a&&!a.isActive&&a.finalHeartRateData&&a.finalHeartRateData.length>0&&e.jsx(X,{data:a.finalHeartRateData,rowers:a.rowers,sessionStartTime:a.startTime,sessionEndTime:a.endTime})]})}):e.jsxs("section",{className:"card-base empty-state",children:[e.jsx(H,{className:"empty-state-icon"}),e.jsx("h3",{className:"empty-state-title",children:"No heart rate data"}),e.jsx("p",{className:"empty-state-description",children:"Connect heart rate devices and assign them to rowers to start monitoring."}),e.jsx("div",{className:"empty-state-action",children:e.jsxs("button",{onClick:()=>g({currentView:"setup"}),className:"btn btn-primary",children:[e.jsx(U,{className:"btn-icon"}),"Setup Devices"]})})]}),e.jsxs("section",{className:"card-base heart-rate-zones",children:[e.jsx("h3",{className:"heart-rate-zones-title",children:"Heart Rate Zones"}),e.jsx("article",{className:"heart-rate-zones-grid",children:Object.entries(h).map(([b,w])=>e.jsxs("div",{className:"heart-rate-zone-item",children:[e.jsx("span",{className:`heart-rate-zone-color ${w.name.toLowerCase()}`}),e.jsx("p",{className:"heart-rate-zone-name",children:w.name}),e.jsxs("p",{className:"heart-rate-zone-range",children:[w.min,"-",w.max," BPM"]})]},b))})]})]})};export{Ke as Dashboard};
