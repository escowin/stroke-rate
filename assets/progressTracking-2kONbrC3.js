import{r as S}from"./charts-BpM2RLF_.js";import{c as z,d as V,e as k,f as E,h as $}from"./sessionAnalytics-aaUY-49P.js";function F({title:o,titleId:i,...r},d){return S.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:d,"aria-labelledby":i},r),o?S.createElement("title",{id:i},o):null,S.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5m-9-6h.008v.008H12v-.008ZM12 15h.008v.008H12V15Zm0 2.25h.008v.008H12v-.008ZM9.75 15h.008v.008H9.75V15Zm0 2.25h.008v.008H9.75v-.008ZM7.5 15h.008v.008H7.5V15Zm0 2.25h.008v.008H7.5v-.008Zm6.75-4.5h.008v.008h-.008v-.008Zm0 2.25h.008v.008h-.008V15Zm0 2.25h.008v.008h-.008v-.008Zm2.25-4.5h.008v.008H16.5v-.008Zm0 2.25h.008v.008H16.5V15Z"}))}const L=S.forwardRef(F),Z=(o,i,r=30)=>{if(o.length<2)return{metric:i,direction:"stable",changeRate:0,confidence:0,trendData:[]};const d=new Date;d.setDate(d.getDate()-r);const m=o.filter(c=>c.date>=d).sort((c,l)=>c.date.getTime()-l.date.getTime());if(m.length<2)return{metric:i,direction:"stable",changeRate:0,confidence:0,trendData:[]};const n=m.map(c=>{const l=i.split(".");let p=c.metrics;for(const H of l)if(p&&typeof p=="object"&&H in p)p=p[H];else return 0;return typeof p=="number"?p:0}),s=n.length,g=m.map((c,l)=>l),u=n,e=g.reduce((c,l)=>c+l,0),h=u.reduce((c,l)=>c+l,0),t=g.reduce((c,l,p)=>c+l*u[p],0),a=g.reduce((c,l)=>c+l*l,0),f=s*a-e*e,R=f!==0?(s*t-e*h)/f:0,y=s>0?(h-R*e)/s:0,T=isNaN(R)?0:R,v=isNaN(y)?0:y,N=h/s,I=u.reduce((c,l,p)=>{const H=T*g[p]+v;return c+Math.pow(l-H,2)},0),x=u.reduce((c,l)=>c+Math.pow(l-N,2),0),P=x>0?Math.max(0,Math.min(1,1-I/x)):0,D=n[0],b=n[n.length-1],M=(m[m.length-1].date.getTime()-m[0].date.getTime())/(1e3*60*60*24*7);let w=0;M>0&&D>0?w=(b-D)/D*100/M:M>0&&D===0&&b>0&&(w=b/M*100),w=isNaN(w)?0:w;let A="stable";Math.abs(w)>1&&(A=w>0?"improving":"declining");const C=m.map((c,l)=>({date:c.date,value:T*l+v}));return{metric:i,direction:A,changeRate:Math.round(w*100)/100,confidence:Math.round(P*100),trendData:C}},B=(o,i)=>{if(!o||o.length===0)return{rowerId:i,rowerName:"",seat:0,trends:[],overallProgress:0,strengths:[],improvementAreas:[]};const r=o.map(e=>e.rowerMetrics.find(h=>h.rowerId===i)).filter(Boolean);if(r.length<2)return{rowerId:i,rowerName:"",seat:0,trends:[],overallProgress:0,strengths:[],improvementAreas:[]};const m=["metrics.avgHeartRate","metrics.maxHeartRate","metrics.trimp","metrics.consistencyScore","metrics.effortScore"].map(e=>{const h=o.map(t=>{const a=t.rowerMetrics.find(f=>f.rowerId===i);return a?{...t,rowerMetrics:[a]}:null}).filter(Boolean);return Z(h,e)}),n=m.filter(e=>e.direction==="improving"),s=n.length>0?Math.round(n.reduce((e,h)=>e+h.confidence,0)/n.length):0,g=[],u=[];return m.forEach(e=>{e.direction==="improving"&&e.confidence>70?g.push(`${e.metric} is improving consistently`):e.direction==="declining"&&e.confidence>50&&u.push(`${e.metric} needs attention`)}),{rowerId:i,rowerName:r[0]?.rowerName||"",seat:r[0]?.seat||0,trends:m,overallProgress:s,strengths:g,improvementAreas:u}},X=o=>{if(!o||o.length<2)return{overallProgress:0,synchronizationTrend:{metric:"crewSynchronization",direction:"stable",changeRate:0,confidence:0,trendData:[]},cohesionTrend:{metric:"crewCohesion",direction:"stable",changeRate:0,confidence:0,trendData:[]},performanceTrend:{metric:"performanceScore",direction:"stable",changeRate:0,confidence:0,trendData:[]},individualTrends:[],crewStrengths:[],crewImprovementAreas:[]};const i=Z(o,"crewSynchronization"),r=Z(o,"crewCohesion"),d=Z(o,"performanceScore"),m=new Set(o.flatMap(t=>t.rowerMetrics.map(a=>a.rowerId))),n=Array.from(m).map(t=>B(o,t)),s=[i,r,d],g=s.filter(t=>t.direction==="improving"),u=g.length>0?Math.round(g.reduce((t,a)=>t+a.confidence,0)/g.length):0,e=[],h=[];return s.forEach(t=>{t.direction==="improving"&&t.confidence>70?e.push(`${t.metric} is improving consistently`):t.direction==="declining"&&t.confidence>50&&h.push(`${t.metric} needs attention`)}),{overallProgress:u,synchronizationTrend:i,cohesionTrend:r,performanceTrend:d,individualTrends:n,crewStrengths:e,crewImprovementAreas:h}},j=(o,i)=>o.filter(r=>r&&r.finalHeartRateData&&r.finalHeartRateData.length>0&&r.rowers&&r.rowers.length>0).map(r=>{const d=z(r,i),m=r.rowers.map(n=>{const s=r.finalHeartRateData.filter(a=>a.deviceId===n.deviceId);if(s.length===0)return{rowerId:n.id,rowerName:n.name,seat:n.seat,metrics:{avgHeartRate:0,maxHeartRate:0,trimp:0,consistencyScore:0,effortScore:0,timeInZones:{recovery:0,aerobic:0,threshold:0,anaerobic:0}}};const g=s.map(a=>a.heartRate),u=Math.round(g.reduce((a,f)=>a+f,0)/g.length),e=Math.max(...g),h=V(s,n.maxHeartRate||180,d.duration),{timeInZones:t}=k(s,i,d.duration);return{rowerId:n.id,rowerName:n.name,seat:n.seat,metrics:{avgHeartRate:u,maxHeartRate:e,trimp:h,consistencyScore:$(s),effortScore:E(u,e,d.duration),timeInZones:t}}});return{date:r.startTime,sessionId:r.id,metrics:d,rowerMetrics:m}}).sort((r,d)=>r.date.getTime()-d.date.getTime()),W=(o,i,r=[],d=[],m=30)=>{const n=new Date,s=new Date;s.setDate(s.getDate()-m);const u=j(o,i).filter(v=>v.date>=s&&v.date<=n),e=X(u),h=e.individualTrends,t=[],a=[],f=[];e.synchronizationTrend.direction==="improving"?t.push("Crew synchronization is improving"):e.synchronizationTrend.direction==="declining"&&(a.push("Crew synchronization is declining"),f.push("Focus on stroke rate synchronization drills")),e.performanceTrend.direction==="improving"?t.push("Overall performance is trending upward"):e.performanceTrend.direction==="declining"&&(a.push("Performance metrics are declining"),f.push("Review training intensity and recovery"));const R=h.filter(v=>v.overallProgress>70),y=h.filter(v=>v.overallProgress<30);R.length>0&&t.push(`${R.length} rower(s) showing strong progress`),y.length>0&&(a.push(`${y.length} rower(s) may need additional support`),f.push("Provide individual coaching for struggling rowers"));let T="Continue current training approach";return a.length>t.length?T="Focus on addressing areas of concern":t.length>0&&(T="Build on current improvements"),{period:{startDate:s,endDate:n,duration:m},totalSessions:u.length,crewProgress:e,individualProgress:h,goals:r,trainingPhases:d,insights:{keyImprovements:t,areasOfConcern:a,recommendations:f,nextPhaseFocus:T}}};export{L as F,W as g};
